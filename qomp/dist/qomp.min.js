(()=>{var E=btoa||(s=>Buffer.from(s).toString("base64")),N=atob||(s=>Buffer.from(s,"base64").toString("utf-8")),g=s=>Promise.resolve().then(s),h=(s,n,t)=>{let e=document.createElement(s);Object.entries(n).forEach(([o,l])=>e.setAttribute(o,l)),t&&e.append(document.createTextNode(t)),document.head.append(e)},y=({link:s,css:n})=>{n.length>0&&h("style",{type:"text/css"},n),s.length>0&&(typeof s=="string"?[s]:s).forEach(e=>h("link",{rel:"stylesheet",href:e}))},b=(s,n)=>n.reduce((t,e)=>t[e],s),c=!1;function p(s,n){let t=Object.assign({elCount:0,importMetaUrl:s,tagName:s.split("/").pop().split(".").shift(),attr:[],props:{},css:()=>"",html:()=>"",update:()=>{},events:()=>[],do:{},style:v,renderClient:S,define:k},n);t.attr=t.attr.concat(["subscribe","events","update"]);let e=Object.assign((...o)=>C.apply(t,o),t);return p.tags.push(e),e}p.tags=[];p.styleAll=()=>{let s={link:[],css:""};return p.tags.forEach(n=>{let t=n.style();t.link&&s.link.push(t.link),t.css&&(s.css+=`
`+t.css)}),s};p.defineAll=({styles:s=!0,context:n=window}={})=>{s&&y(p.styleAll()),p.tags.forEach(t=>{t.define({styles:!1,context:n})})};function v(){let s=this,n={};return s.css===!0?n.link=s.importMetaUrl.replace(".js",".css"):n.css=s.css(s.tagName).trim(),n}function C(s="",n={},t=""){let e=this;return e.elCount++,Array.isArray(t)&&(t=t.join(`
`)),`<${e.tagName} ${s} data-props="${E(JSON.stringify(n))}">  ${e.html({props:n}).replace("<slot></slot>",t)}</${e.tagName}>`}function S(s,n={}){let t=this;t.elCount++;let e=t.html({props:n});if(!e.includes("<slot>")){s.innerHTML=e;return}let o=document.createElement("div");[...s.childNodes].filter(r=>r.textContent.trim()).forEach(r=>o.appendChild(r)),s.innerHTML=e;for(let r of[...o.childNodes]){let a=s.querySelector("slot");if(a)a.parentNode.replaceChild(r,a);else{console.warn(t.tagName,s.id,": more children than slots, or maybe bad closing tag");break}}}function k({styles:s=!0,context:n=window}={}){let t=this;c&&t.tagName,s&&y(t.style()),customElements.define(t.tagName,class extends HTMLElement{constructor(){super();let e=this;c&&(t.tagName,e.id),e.mem={props:Object.assign({},t.props),ready:!1,update(){let o=JSON.stringify(e.mem.props);e.mem.propsStr!==o&&(e.mem.propsStr=o,(e.mem.updateAttr||t.update)({el:e,props:e.mem.props,set:(l,r)=>{e.querySelector(l).innerHTML=r}}),e.dispatchEvent(new CustomEvent("change",{detail:{...e.mem.props}})))},elEvents:void 0},e.do={},Object.entries(t.do).forEach(([o,l])=>{e.do[o]=l.bind(e.mem)})}connectedCallback(){let e=this;if(this.mem.ready){c&&(t.tagName,e.id);return}c&&(t.tagName,e.id),g(()=>{e.dataset.props?(c&&(t.tagName,e.id),Object.assign(e.mem.props,JSON.parse(N(e.dataset.props)))):(c&&(t.tagName,e.id),t.renderClient(e,e.mem.props)),c&&(t.tagName,e.id),e.mem.elEvents=e.mem.elEvents||t.events({el:e}),e.mem.elEvents.forEach(([l,r,a])=>{e.querySelector(l).addEventListener(r,a)}),e.mem.update(),e.mem.ready=!0})}disconnectedCallback(){let e=this;if(e.parentElement){c&&(t.tagName,e.id);return}c&&(t.tagName,e.id),c&&(t.tagName,e.id),e.mem.elEvents.forEach(([o,l,r])=>e.querySelector(o).removeEventListener(l,r)),e.mem.elEvents=[],e.mem.unsubscribe&&e.mem.unsubscribe()}set props(e){let o=this;Object.assign(o.mem.props,e),o.mem.ready&&o.mem.update()}get props(){return{...this.mem.props}}static get observedAttributes(){return t.attr}attributeChangedCallback(e,o,l){let r=this;if(e==="subscribe")g(()=>{r.mem.unsubscribe&&r.mem.unsubscribe();let[a,...i]=l.split(".");r.mem.unsubscribe=n[a].subscribe(m=>{r.props=b(m,i)})});else if(e==="events")r.mem.elEvents=l.split(";").map(a=>a.split(":").map(i=>i.trim())).map(([a,i,m,...d])=>({qs:a,ev:i,fnPath:m,fnArgs:d})).map(({qs:a,ev:i,fnPath:m,fnArgs:d})=>{let u=b(n,m.split("."));return[a,i,()=>u.apply(null,d)]});else if(e==="update"){let a=l.split(";").map(i=>i.split(":").map(m=>m.trim()));r.mem.updateAttr=({props:i,el:m,set:d})=>{a.forEach(([u,f])=>{d(u,i[f])})}}else r.props={[e]:l}}})}})();
